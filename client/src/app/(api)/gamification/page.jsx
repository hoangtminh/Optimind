"use client";
import {
	Card,
	CardContent,
	CardDescription,
	CardHeader,
	CardTitle,
} from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Progress } from "@/components/ui/progress";
import {
	Sparkles,
	Lock,
	Star,
	Trophy,
	Clock,
	Zap,
	Crown,
	Heart,
	TrendingUp,
} from "lucide-react";
import { usePet } from "@/hooks/use-pet";

export default function GamificationPage() {
	const { pets, totalStudyHours, addStudyTime, setActivePet, getActivePet } =
		usePet();
	const activePet = getActivePet();

	const getRarityColor = (rarity) => {
		switch (rarity) {
			case "common":
				return "bg-gradient-to-br from-cyan-50 to-cyan-100 border-gray-200";
			case "uncommon":
				return "bg-gradient-to-br from-green-50 to-green-100 border-green-200";
			case "rare":
				return "bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200";
			case "epic":
				return "bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200";
			case "legendary":
				return "bg-gradient-to-br from-yellow-50 to-orange-100 border-yellow-200";
			case "mythic":
				return "bg-gradient-to-br from-pink-50 to-rose-100 border-pink-200";
			case "cosmic":
				return "bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 border-indigo-200";
			default:
				return "bg-gradient-to-br from-gray-50 to-gray-100 border-gray-200";
		}
	};

	const getRarityTextColor = (rarity) => {
		switch (rarity) {
			case "common":
				return "text-cyan-800";
			case "uncommon":
				return "text-green-800";
			case "rare":
				return "text-blue-800";
			case "epic":
				return "text-purple-800";
			case "legendary":
				return "text-yellow-800";
			case "mythic":
				return "text-pink-800";
			case "cosmic":
				return "text-indigo-800";
			default:
				return "text-gray-800";
		}
	};

	const getStageEmoji = (stage) => {
		switch (stage) {
			case "egg":
				return "ü•ö";
			case "baby":
				return "üê£";
			case "teen":
				return "üê•";
			case "adult":
				return "ü¶Ö";
			case "master":
				return "üëë";
			default:
				return "ü•ö";
		}
	};

	const getStageName = (stage) => {
		switch (stage) {
			case "egg":
				return "Tr·ª©ng";
			case "baby":
				return "B√©";
			case "teen":
				return "Thi·∫øu ni√™n";
			case "adult":
				return "Tr∆∞·ªüng th√†nh";
			case "master":
				return "B·∫≠c th·∫ßy";
			default:
				return "Tr·ª©ng";
		}
	};

	return (
		<div className="space-y-6">
			<div className="flex items-center justify-between">
				<div>
					<h1 className="text-3xl font-bold text-blue-600">
						Nu√¥i Pet H·ªçc T·∫≠p
					</h1>
					<p className="text-muted-foreground mt-1">
						Nu√¥i pet t·ª´ tr·ª©ng v√† ph√°t tri·ªÉn ch√∫ng b·∫±ng c√°ch h·ªçc t·∫≠p
					</p>
				</div>
			</div>

			<div className="grid grid-cols-1 md:grid-cols-4 gap-6">
				<Card className="bg-gradient-to-br from-blue-50 to-cyan-100 border-blue-200">
					<CardHeader>
						<div className="flex items-center justify-between">
							<CardTitle className="text-xl font-bold text-blue-800">
								T·ªïng gi·ªù h·ªçc
							</CardTitle>
							<Clock className="h-5 w-5 text-blue-600" />
						</div>
					</CardHeader>
					<CardContent>
						<div className="text-3xl font-bold text-blue-900">
							{totalStudyHours.toFixed(1)}h
						</div>
						<p className="text-sm text-blue-600 mt-1">
							H·ªçc ti·∫øp ƒë·ªÉ m·ªü kh√≥a pet m·ªõi
						</p>
					</CardContent>
				</Card>

				<Card className="bg-gradient-to-br from-purple-50 to-pink-100 border-purple-200">
					<CardHeader>
						<div className="flex items-center justify-between">
							<CardTitle className="text-xl font-bold text-purple-800">
								Pet ƒë√£ m·ªü
							</CardTitle>
							<Trophy className="h-5 w-5 text-purple-600" />
						</div>
					</CardHeader>
					<CardContent>
						<div className="text-3xl font-bold text-purple-900">
							{pets.filter((p) => p.unlocked).length}/
							{pets.length}
						</div>
						<p className="text-sm text-purple-600 mt-1">
							S∆∞u t·∫≠p ƒë·∫ßy ƒë·ªß
						</p>
					</CardContent>
				</Card>

				<Card className="bg-gradient-to-br from-green-50 to-emerald-100 border-green-200">
					<CardHeader>
						<div className="flex items-center justify-between">
							<CardTitle className="text-xl font-bold text-green-800">
								Pet ƒëang nu√¥i
							</CardTitle>
							<Heart className="h-5 w-5 text-green-600" />
						</div>
					</CardHeader>
					<CardContent>
						<div className="text-3xl font-bold text-green-900">
							{activePet ? activePet.name : "Ch∆∞a c√≥"}
						</div>
						<p className="text-sm text-green-600 mt-1">
							{activePet
								? getStageName(activePet.stage)
								: "Ch·ªçn pet"}
						</p>
					</CardContent>
				</Card>

				<Card className="bg-gradient-to-br from-orange-50 to-yellow-100 border-orange-200">
					<CardHeader>
						<div className="flex items-center justify-between">
							<CardTitle className="text-xl font-bold text-orange-800">
								C·∫•p ƒë·ªô cao nh·∫•t
							</CardTitle>
							<Crown className="h-5 w-5 text-orange-600" />
						</div>
					</CardHeader>
					<CardContent>
						<div className="text-3xl font-bold text-orange-900">
							{pets.filter((p) => p.stage === "master").length}
						</div>
						<p className="text-sm text-orange-600 mt-1">
							Pet ƒë·∫°t b·∫≠c th·∫ßy
						</p>
					</CardContent>
				</Card>
			</div>

			{activePet && (
				<Card
					className={`${getRarityColor(activePet.rarity)} border-2`}
				>
					<CardHeader>
						<div className="flex items-center justify-between">
							<div>
								<CardTitle
									className={`text-2xl ${getRarityTextColor(
										activePet.rarity
									)}`}
								>
									{getStageEmoji(activePet.stage)}{" "}
									{activePet.name}
								</CardTitle>
								<CardDescription
									className={getRarityTextColor(
										activePet.rarity
									)}
								>
									{getStageName(activePet.stage)} -{" "}
									{activePet.rarity.toUpperCase()}
								</CardDescription>
							</div>
							<Badge
								className={`text-lg px-4 py-2 bg-gradient-to-r ${activePet.color} text-white border-0`}
							>
								<Star className="h-4 w-4 mr-1" />
								{activePet.rarity}
							</Badge>
						</div>
					</CardHeader>
					<CardContent className="space-y-4">
						<div className="bg-white/60 p-4 rounded-lg">
							<div className="flex justify-between items-center mb-2">
								<span
									className={`text-sm font-medium ${getRarityTextColor(
										activePet.rarity
									)}`}
								>
									Kinh nghi·ªám ƒë·∫øn c·∫•p ti·∫øp theo
								</span>
								<span
									className={`text-sm font-bold ${getRarityTextColor(
										activePet.rarity
									)}`}
								>
									{activePet.experience.toFixed(1)}/
									{activePet.requiredExp}h
								</span>
							</div>
							<Progress
								value={
									(activePet.experience /
										activePet.requiredExp) *
									100
								}
								className="h-3"
								indicatorClassName={`bg-gradient-to-r ${activePet.color}`}
							/>
							<p
								className={`text-xs mt-2 ${getRarityTextColor(
									activePet.rarity
								)}`}
							>
								H·ªçc th√™m{" "}
								{(
									activePet.requiredExp - activePet.experience
								).toFixed(1)}{" "}
								gi·ªù ƒë·ªÉ l√™n c·∫•p
							</p>
						</div>

						<div className="grid grid-cols-5 gap-2">
							{["egg", "baby", "teen", "adult", "master"].map(
								(stage, index) => {
									const stages = [
										"egg",
										"baby",
										"teen",
										"adult",
										"master",
									];
									const currentIndex = stages.indexOf(
										activePet.stage
									);
									const isCompleted = index <= currentIndex;
									return (
										<div
											key={stage}
											className={`p-3 rounded-lg text-center transition-all ${
												isCompleted
													? `bg-gradient-to-br ${activePet.color} text-white`
													: "bg-white/40 text-gray-400"
											}`}
										>
											<div className="text-2xl mb-1">
												{getStageEmoji(stage)}
											</div>
											<div className="text-xs font-medium">
												{getStageName(stage)}
											</div>
										</div>
									);
								}
							)}
						</div>
					</CardContent>
				</Card>
			)}

			<div>
				<h2 className="text-2xl font-bold mb-4 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
					B·ªô s∆∞u t·∫≠p Pet
				</h2>
				<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
					{pets.map((pet) => (
						<Card
							key={pet.id}
							className={`${getRarityColor(
								pet.rarity
							)} transition-all duration-300 hover:shadow-lg ${
								pet.active
									? "ring-2 ring-offset-2 ring-purple-500"
									: ""
							} ${!pet.unlocked ? "opacity-60" : ""}`}
						>
							<CardHeader className="pb-3">
								<div className="flex items-start justify-between">
									<div className="flex-1">
										<div className="flex items-center gap-2 mb-2">
											<div className="text-3xl">
												{pet.unlocked
													? getStageEmoji(pet.stage)
													: "üîí"}
											</div>
											<div>
												<CardTitle
													className={`text-base ${getRarityTextColor(
														pet.rarity
													)}`}
												>
													{pet.unlocked
														? pet.name
														: "???"}
												</CardTitle>
												<Badge
													className={`text-xs mt-1 bg-gradient-to-r ${pet.color} text-white border-0`}
													variant="outline"
												>
													{pet.rarity}
												</Badge>
											</div>
										</div>
									</div>
									{pet.active && (
										<Badge className="bg-green-500 text-white">
											<Zap className="h-3 w-3 mr-1" />
											ƒêang nu√¥i
										</Badge>
									)}
								</div>
							</CardHeader>
							<CardContent className="space-y-3">
								<div className="bg-white/60 p-3 rounded-lg space-y-2">
									{pet.unlocked ? (
										<>
											<div className="flex justify-between text-xs">
												<span
													className={getRarityTextColor(
														pet.rarity
													)}
												>
													Giai ƒëo·∫°n:
												</span>
												<span
													className={`font-medium ${getRarityTextColor(
														pet.rarity
													)}`}
												>
													{getStageName(pet.stage)}
												</span>
											</div>
											<div className="flex justify-between text-xs">
												<span
													className={getRarityTextColor(
														pet.rarity
													)}
												>
													Kinh nghi·ªám:
												</span>
												<span
													className={`font-medium ${getRarityTextColor(
														pet.rarity
													)}`}
												>
													{pet.experience.toFixed(1)}/
													{pet.requiredExp}h
												</span>
											</div>
											<Progress
												value={
													(pet.experience /
														pet.requiredExp) *
													100
												}
												className="h-2"
												indicatorClassName={`bg-gradient-to-r ${pet.color}`}
											/>
										</>
									) : (
										<>
											<div className="flex items-center gap-2 text-xs text-gray-600">
												<Lock className="h-3 w-3" />
												<span>
													C·∫ßn {pet.studyHoursRequired}
													h h·ªçc t·∫≠p
												</span>
											</div>
											<Progress
												value={
													(totalStudyHours /
														pet.studyHoursRequired) *
													100
												}
												className="h-2"
												indicatorClassName="bg-gray-400"
											/>
											<p className="text-xs text-gray-600">
												C√≤n{" "}
												{Math.max(
													0,
													pet.studyHoursRequired -
														totalStudyHours
												).toFixed(1)}
												h n·ªØa
											</p>
										</>
									)}
								</div>

								<Button
									onClick={() => setActivePet(pet.id)}
									disabled={!pet.unlocked || pet.active}
									className={`w-full ${
										pet.active
											? "bg-green-500 hover:bg-green-500"
											: `bg-gradient-to-r ${pet.color} hover:opacity-90`
									}`}
								>
									{pet.active ? (
										<>
											<Heart className="h-4 w-4 mr-2" />
											ƒêang nu√¥i
										</>
									) : pet.unlocked ? (
										<>
											<Sparkles className="h-4 w-4 mr-2" />
											Ch·ªçn nu√¥i
										</>
									) : (
										<>
											<Lock className="h-4 w-4 mr-2" />
											Ch∆∞a m·ªü kh√≥a
										</>
									)}
								</Button>
							</CardContent>
						</Card>
					))}
				</div>
			</div>

			<Card className="bg-gradient-to-br from-indigo-50 to-purple-100 border-indigo-200">
				<CardHeader>
					<CardTitle className="flex items-center gap-2 text-indigo-800">
						<TrendingUp className="h-5 w-5" />
						H∆∞·ªõng d·∫´n nu√¥i Pet
					</CardTitle>
				</CardHeader>
				<CardContent className="space-y-3">
					<div className="bg-white/60 p-4 rounded-lg">
						<h3 className="font-semibold text-indigo-800 mb-2">
							C√°ch m·ªü kh√≥a Pet m·ªõi:
						</h3>
						<ul className="space-y-1 text-sm text-indigo-700">
							<li>‚Ä¢ H·ªçc t·∫≠p ƒë·ªÉ t√≠ch l≈©y gi·ªù h·ªçc</li>
							<li>
								‚Ä¢ M·ªói pet c·∫ßn s·ªë gi·ªù h·ªçc kh√°c nhau ƒë·ªÉ m·ªü kh√≥a
							</li>
							<li>‚Ä¢ Pet hi·∫øm h∆°n c·∫ßn nhi·ªÅu gi·ªù h·ªçc h∆°n</li>
						</ul>
					</div>
					<div className="bg-white/60 p-4 rounded-lg">
						<h3 className="font-semibold text-indigo-800 mb-2">
							C√°ch ph√°t tri·ªÉn Pet:
						</h3>
						<ul className="space-y-1 text-sm text-indigo-700">
							<li>
								‚Ä¢ Ch·ªçn m·ªôt pet ƒë·ªÉ nu√¥i (ch·ªâ nu√¥i ƒë∆∞·ª£c 1 pet c√πng
								l√∫c)
							</li>
							<li>‚Ä¢ M·ªói gi·ªù h·ªçc s·∫Ω cho pet kinh nghi·ªám</li>
							<li>
								‚Ä¢ Pet s·∫Ω ph√°t tri·ªÉn qua 5 giai ƒëo·∫°n: Tr·ª©ng ‚Üí B√©
								‚Üí Thi·∫øu ni√™n ‚Üí Tr∆∞·ªüng th√†nh ‚Üí B·∫≠c th·∫ßy
							</li>
							<li>
								‚Ä¢ Pet hi·∫øm h∆°n c·∫ßn nhi·ªÅu kinh nghi·ªám h∆°n ƒë·ªÉ l√™n
								c·∫•p
							</li>
						</ul>
					</div>
				</CardContent>
			</Card>
		</div>
	);
}
